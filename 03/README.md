## 集群

> 虽然redis有持久化功能能够保障redis服务器宕机也能恢复并且只有少量的数据损失，但是由于所有数据在一台服务器上，如果这台服务器出现硬盘故障，那就算是有备份也仍然不可避免数据丢失的问题。
> 在实际生产环境中，我们不可能只使用一台redis服务器作为我们的缓存服务器，必须要多台实现集群，避免出现单点故障；

## 主从复制

> 复制的作用是把redis的数据库复制多个副本部署在不同的服务器上，如果其中一台服务器出现故障，也能**快速迁移**到其他服务器上提供服务。 复制功能可以实现当一台redis服务器的数据更新后，自动将新的**数据同步**到其他服务器上主从复制就是我们常见的master/slave模式， 主数据库可以进行读写操作，当写操作导致数据发生变化时会自动将数据同步给从数据库。而一般情况下，**从数据库是只读**的，并接收主数据库同步过来的数据。 **一个主**数据库可以有**多个从**数据库

![](image/001.png)

#### 配置

在redis中配置master/slave是非常容易的，只需要在从数据库的配置文件中加入slaveof 主数据库地址 端口。 而master 数据库不需要做任何改变

#### 原理

##### 全量复制

Redis全量复制一般发生在**Slave初始化阶段**，这时Slave需要将Master上的所有数据都复制一份。具体步骤

![](image/002.png)

min-slaves-to-write 3 表示只有当3个或以上的slave连接到master，master才是可写的
min-slaves-max-lag 10 表示允许slave最长失去连接的时间，如果10秒还没收到slave的响应，则master认为该
slave以断开

##### 增量复制

##### 无硬盘复制

#### 哨兵机制

